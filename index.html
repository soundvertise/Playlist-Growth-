<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soundvertise - Playlist Growth</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        :root {
            --glass-bg: rgba(20, 20, 20, 0.95);
            --accent-purple: #9575cd;
            --text-main: #ffffff;
            --border-radius: 12px;
        }

        body {
            background-color: #000;
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* --- API CONFIG (Hidden in Export) --- */
        .api-config {
            background: #222;
            padding: 10px;
            width: 100%;
            text-align: center;
            border-bottom: 1px solid #444;
            font-size: 0.8rem;
        }
        .api-config input {
            background: #333;
            border: 1px solid #555;
            color: white;
            padding: 5px;
            width: 200px;
        }

        /* --- MAIN CANVAS AREA (This is what gets exported) --- */
        #canvas-area {
            /* The background image is applied here so it gets captured by the PDF */
            background: url('Fabhertz_aesthetic_background_wallpaper_for_a_website_landing_p_bbf86bfd-9b57-4afc-b01e-4da55c2315f3.jpeg') no-repeat center center;
            background-size: cover;
            width: 100%;
            max-width: 1400px; /* Fixed width for consistent PDF */
            min-height: 100vh;
            padding: 40px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- HEADER --- */
        header {
            text-align: center;
            margin-bottom: 30px;
            width: 100%;
            background: rgba(0,0,0,0.6); /* Readability behind logo */
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(5px);
        }

        header img {
            max-width: 180px;
            margin-bottom: 10px;
        }

        .header-titles h1 {
            font-size: 1.2rem;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 3px;
            font-weight: 600;
            opacity: 0.9;
        }

        .artist-input {
            background: transparent;
            border: none;
            border-bottom: 2px solid var(--accent-purple);
            color: white;
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            width: 50%;
            padding: 5px;
            margin-top: 10px;
        }
        .artist-input:focus { outline: none; border-bottom-color: #fff; }

        /* --- GRID LAYOUT --- */
        .main-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 25px;
            width: 100%;
        }

        .col {
            background: var(--glass-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(255,255,255,0.1);
        }

        h2 {
            font-size: 1.1rem;
            text-transform: uppercase;
            border-bottom: 1px solid #444;
            padding-bottom: 15px;
            margin-top: 0;
            margin-bottom: 20px;
            color: var(--accent-purple);
            letter-spacing: 1px;
        }

        /* --- ACTION BUTTONS (Lock/Unlock) --- */
        .action-btn {
            background: #333;
            color: white;
            border: 1px solid #555;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            margin-top: 15px;
            font-size: 0.9rem;
            transition: 0.3s;
        }
        .action-btn:hover { background: var(--accent-purple); border-color: var(--accent-purple); }
        .action-btn.locked { background: var(--accent-purple); }

        /* --- INPUT STYLES --- */
        label { display: block; margin-top: 10px; font-size: 0.85rem; color: #bbb; }
        input, select {
            width: 100%; padding: 10px; margin-top: 5px;
            background: #2a2a2a; border: 1px solid #444;
            border-radius: 6px; color: white;
            font-family: 'Inter', sans-serif; box-sizing: border-box;
        }

        /* --- LEFT COL: Schedule --- */
        .schedule-row {
            background: #252525;
            border: 1px solid #333;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
        }
        .schedule-header {
            display: flex; justify-content: space-between;
            font-size: 0.95rem; margin-bottom: 5px;
            color: white; font-weight: bold;
        }
        .schedule-dates { font-size: 0.8rem; color: #aaa; }
        
        /* LOCKED VIEW STYLES (Left) */
        .locked-schedule-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #333;
        }
        .locked-schedule-item:last-child { border-bottom: none; }
        .locked-month { font-weight: bold; color: var(--accent-purple); font-size: 1.1rem; }
        .locked-date { display: block; font-size: 0.85rem; color: #ccc; margin-top: 2px; }
        .locked-cost { font-size: 1.2rem; font-weight: bold; }

        /* --- CENTER COL: Spotify --- */
        .spotify-preview {
            display: flex; flex-direction: column; align-items: center; text-align: center;
            margin-top: 20px;
        }
        .artwork-container {
            width: 280px; height: 280px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.6);
            margin-bottom: 25px; border-radius: 10px;
            overflow: hidden; background: #000;
        }
        .artwork-container img { width: 100%; height: 100%; object-fit: cover; }
        .playlist-title { font-size: 1.6rem; font-weight: 700; margin: 10px 0 5px 0; line-height: 1.2;}
        .playlist-owner { font-size: 1rem; color: #999; margin-bottom: 10px; }
        .playlist-followers {
            background: rgba(255,255,255,0.1);
            padding: 8px 16px; border-radius: 20px;
            color: #fff; font-size: 0.9rem; font-weight: 600;
            text-transform: uppercase; letter-spacing: 1px;
        }

        /* --- RIGHT COL: Tiers --- */
        .tier-group { margin-bottom: 15px; border: 1px solid #444; border-radius: 8px; overflow: hidden; }
        .tier-header { background: #333; padding: 8px 10px; display: flex; justify-content: space-between; }
        .tier-countries { padding: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        
        /* LOCKED VIEW STYLES (Right) */
        .locked-tier-block { margin-bottom: 20px; }
        .locked-tier-title { color: var(--accent-purple); font-weight: bold; margin-bottom: 8px; font-size: 1rem; text-transform: uppercase;}
        .locked-country-list { 
            display: flex; flex-wrap: wrap; gap: 8px; 
        }
        .country-badge {
            background: #333; color: #ddd; 
            padding: 5px 10px; border-radius: 4px; 
            font-size: 0.85rem; border: 1px solid #444;
        }

        /* --- EXPORT BUTTON --- */
        .export-container {
            position: fixed; bottom: 30px; right: 30px; z-index: 100;
        }
        .export-btn {
            background-color: var(--accent-purple);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            transition: transform 0.2s;
        }
        .export-btn:hover { transform: scale(1.05); background-color: #7e57c2; }

        /* UTILITY: Hide elements */
        .hidden { display: none !important; }
        .total-display {
            margin-top: 20px; padding-top: 15px; border-top: 1px solid #555;
            font-size: 1.4rem; font-weight: bold; text-align: right; color: var(--accent-purple);
        }

    </style>
</head>
<body>

    <div class="api-config hide-on-export">
        <span>Spotify API:</span>
        <input type="text" id="clientId" placeholder="Client ID">
        <input type="password" id="clientSecret" placeholder="Client Secret">
    </div>

    <div id="canvas-area">
        <header>
            <img src="LOGO WHITE NO BACKGROUND .png" alt="Soundvertise" onerror="this.style.display='none'">
            <div class="header-titles">
                <h1>Playlist Growth</h1>
                <input type="text" class="artist-input" placeholder="Artist Name" value="Artist Name">
            </div>
        </header>

        <div class="main-container">
            
            <div class="col">
                <h2>Campaign Plan</h2>
                
                <div id="left-edit-mode">
                    <label>Duration (Months)</label>
                    <select id="months" onchange="generateSchedule()">
                        <option value="1">1 Month</option>
                        <option value="2">2 Months</option>
                        <option value="3">3 Months</option>
                        <option value="4">4 Months</option>
                        <option value="5">5 Months</option>
                        <option value="6">6 Months</option>
                    </select>

                    <label>Start Date</label>
                    <input type="date" id="startDate" onchange="generateSchedule()">
                    
                    <div id="scheduleContainer" style="margin-top:15px;"></div>
                </div>

                <div id="left-view-mode" class="hidden">
                    <div id="locked-schedule-list"></div>
                </div>

                <div class="total-display" id="totalDisplay">Total: €0.00</div>

                <button class="action-btn hide-on-export" id="btn-lock-left" onclick="toggleLeft()">Confirm & Lock Plan</button>
            </div>

            <div class="col">
                <h2>Playlist Preview</h2>
                
                <div id="center-edit-mode" class="hide-on-export">
                    <div style="display:flex; gap:5px;">
                        <input type="text" id="spotifyUrl" placeholder="Spotify Playlist URL...">
                        <button onclick="fetchSpotifyData()" style="width:auto; cursor:pointer;">Load</button>
                    </div>
                </div>

                <div class="spotify-preview" id="spotifyPreview" style="display:none;">
                    <div class="artwork-container">
                        <img id="plArtwork" src="" alt="Cover">
                    </div>
                    <div class="playlist-title" id="plTitle">Title</div>
                    <div class="playlist-owner" id="plOwner">by Owner</div>
                    <div class="playlist-followers" id="plFollowers">0 Followers</div>
                </div>
            </div>

            <div class="col">
                <h2>Target Countries</h2>
                
                <div id="right-edit-mode" class="tiers-container">
                    <div id="tiersContainer"></div> </div>

                <div id="right-view-mode" class="hidden">
                    <div id="locked-tiers-list"></div>
                </div>

                <button class="action-btn hide-on-export" id="btn-lock-right" onclick="toggleRight()">Confirm & Lock Targets</button>
            </div>
        </div>
    </div>

    <div class="export-container hide-on-export">
        <button class="export-btn" onclick="exportToPDF()">Export PDF</button>
    </div>

    <script>
        // --- STATE MANAGEMENT ---
        let leftLocked = false;
        let rightLocked = false;

        // --- 1. LEFT COLUMN LOGIC ---
        function generateSchedule() {
            const months = parseInt(document.getElementById('months').value);
            const startDateInput = document.getElementById('startDate').value;
            const container = document.getElementById('scheduleContainer');
            
            // Save old values to persist them during redraw
            const oldInputs = document.querySelectorAll('.monthly-cost');
            const oldValues = Array.from(oldInputs).map(i => i.value);

            container.innerHTML = '';

            if (!startDateInput) return;

            let currentDate = new Date(startDateInput);

            for (let i = 1; i <= months; i++) {
                let startStr = currentDate.toLocaleDateString('en-GB');
                let endDate = new Date(currentDate);
                endDate.setDate(currentDate.getDate() + 27);
                let endStr = endDate.toLocaleDateString('en-GB');

                const val = oldValues[i-1] || '';

                const row = document.createElement('div');
                row.className = 'schedule-row';
                row.innerHTML = `
                    <div class="schedule-header">
                        Month ${i}
                        <input type="hidden" class="hidden-date-range" value="${startStr} - ${endStr}">
                    </div>
                    <div class="schedule-dates">${startStr} - ${endStr}</div>
                    <input type="number" class="monthly-cost" value="${val}" placeholder="Cost €" oninput="calculateTotal()">
                `;
                container.appendChild(row);
                currentDate.setDate(currentDate.getDate() + 28);
            }
            calculateTotal();
        }

        function calculateTotal() {
            const inputs = document.querySelectorAll('.monthly-cost');
            let total = 0;
            inputs.forEach(inp => total += (parseFloat(inp.value) || 0));
            document.getElementById('totalDisplay').innerText = `Total: €${total.toFixed(2)}`;
            return total; // Return for use in lock view
        }

        function toggleLeft() {
            const editMode = document.getElementById('left-edit-mode');
            const viewMode = document.getElementById('left-view-mode');
            const btn = document.getElementById('btn-lock-left');
            const list = document.getElementById('locked-schedule-list');

            if (!leftLocked) {
                // LOCK IT
                list.innerHTML = '';
                const rows = document.querySelectorAll('.schedule-row');
                
                rows.forEach((row, index) => {
                    const dates = row.querySelector('.hidden-date-range').value;
                    const costVal = row.querySelector('.monthly-cost').value;
                    const cost = costVal ? `€${parseFloat(costVal).toFixed(2)}` : '€0.00';

                    list.innerHTML += `
                        <div class="locked-schedule-item">
                            <div>
                                <div class="locked-month">Month ${index + 1}</div>
                                <span class="locked-date">${dates}</span>
                            </div>
                            <div class="locked-cost">${cost}</div>
                        </div>
                    `;
                });

                editMode.classList.add('hidden');
                viewMode.classList.remove('hidden');
                btn.innerText = "Edit Plan";
                btn.classList.add('locked');
                leftLocked = true;
            } else {
                // UNLOCK IT
                editMode.classList.remove('hidden');
                viewMode.classList.add('hidden');
                btn.innerText = "Confirm & Lock Plan";
                btn.classList.remove('locked');
                leftLocked = false;
            }
        }

        // --- 2. SPOTIFY LOGIC ---
        // Optional: Hardcode keys here to avoid typing every time
        // const HARDCODED_CLIENT_ID = 'your_id';
        // const HARDCODED_CLIENT_SECRET = 'your_secret';

        async function getAccessToken() {
            const clientId = document.getElementById('clientId').value || (typeof HARDCODED_CLIENT_ID !== 'undefined' ? HARDCODED_CLIENT_ID : '');
            const clientSecret = document.getElementById('clientSecret').value || (typeof HARDCODED_CLIENT_SECRET !== 'undefined' ? HARDCODED_CLIENT_SECRET : '');

            if(!clientId || !clientSecret) { alert("Missing API Credentials"); return null; }

            const result = await fetch('https://accounts.spotify.com/api/token', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded', 'Authorization': 'Basic ' + btoa(clientId + ':' + clientSecret) },
                body: 'grant_type=client_credentials'
            });
            const data = await result.json();
            return data.access_token;
        }

        async function fetchSpotifyData() {
            const url = document.getElementById('spotifyUrl').value;
            const match = url.match(/playlist\/([a-zA-Z0-9]+)/);
            if (!match) return alert("Invalid URL");
            
            const token = await getAccessToken();
            if (!token) return;

            try {
                const result = await fetch(`https://api.spotify.com/v1/playlists/${match[1]}`, {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const data = await result.json();

                document.getElementById('spotifyPreview').style.display = 'flex';
                document.getElementById('plTitle').innerText = data.name;
                document.getElementById('plOwner').innerText = `by ${data.owner.display_name}`;
                document.getElementById('plFollowers').innerText = `${data.followers.total.toLocaleString()} FOLLOWERS`;
                if (data.images.length > 0) document.getElementById('plArtwork').src = data.images[0].url;
            } catch (e) { alert("Error fetching data"); }
        }

        // --- 3. RIGHT COLUMN LOGIC ---
        const tiersData = {
            "Tier 1 (Premium)": ["USA", "UK", "Canada", "Australia", "Germany", "France", "Japan", "Netherlands", "Sweden"],
            "Tier 2 (Standard)": ["Italy", "Spain", "Brazil", "Mexico", "Poland", "Belgium", "Austria", "Switzerland", "Norway", "Finland"],
            "Tier 3 (Emerging)": ["Turkey", "India", "Indonesia", "Philippines", "Thailand", "Vietnam", "Argentina", "Chile", "Colombia"]
        };

        function renderTiersInput() {
            const container = document.getElementById('tiersContainer');
            Object.keys(tiersData).forEach((tierName, index) => {
                container.innerHTML += `
                    <div class="tier-group">
                        <div class="tier-header">
                            <strong>${tierName}</strong>
                            <input type="checkbox" checked onchange="toggleTierGroup(this, 'tlist-${index}')">
                        </div>
                        <div class="tier-countries" id="tlist-${index}">
                            ${tiersData[tierName].map(c => `
                                <label style="display:flex; align-items:center;">
                                    <input type="checkbox" value="${c}" checked> ${c}
                                </label>`).join('')}
                        </div>
                    </div>
                `;
            });
        }

        function toggleTierGroup(cb, id) {
            const inputs = document.getElementById(id).querySelectorAll('input');
            inputs.forEach(i => i.disabled = !cb.checked);
            document.getElementById(id).style.opacity = cb.checked ? '1' : '0.3';
        }

        function toggleRight() {
            const editMode = document.getElementById('right-edit-mode');
            const viewMode = document.getElementById('right-view-mode');
            const btn = document.getElementById('btn-lock-right');
            const list = document.getElementById('locked-tiers-list');

            if (!rightLocked) {
                // LOCK
                list.innerHTML = '';
                let hasSelection = false;

                Object.keys(tiersData).forEach((tierName, index) => {
                    const groupInputs = document.querySelectorAll(`#tlist-${index} input:checked:not(:disabled)`);
                    if (groupInputs.length > 0) {
                        hasSelection = true;
                        let countriesHtml = Array.from(groupInputs).map(i => `<span class="country-badge">${i.value}</span>`).join('');
                        list.innerHTML += `
                            <div class="locked-tier-block">
                                <div class="locked-tier-title">${tierName}</div>
                                <div class="locked-country-list">${countriesHtml}</div>
                            </div>
                        `;
                    }
                });

                if (!hasSelection) list.innerHTML = '<p style="color:#888; font-style:italic">No countries selected</p>';

                editMode.classList.add('hidden');
                viewMode.classList.remove('hidden');
                btn.innerText = "Edit Targets";
                btn.classList.add('locked');
                rightLocked = true;
            } else {
                // UNLOCK
                editMode.classList.remove('hidden');
                viewMode.classList.add('hidden');
                btn.innerText = "Confirm & Lock Targets";
                btn.classList.remove('locked');
                rightLocked = false;
            }
        }

        // --- 4. EXPORT ---
        function exportToPDF() {
            // Hide elements that shouldn't be in PDF
            const toHide = document.querySelectorAll('.hide-on-export');
            toHide.forEach(el => el.classList.add('hidden'));

            const element = document.getElementById('canvas-area');
            const opt = {
                margin:       0,
                filename:     'playlist_growth_plan.pdf',
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2, useCORS: true, scrollX: 0, scrollY: 0 },
                jsPDF:        { unit: 'in', format: 'a4', orientation: 'landscape' }
            };

            html2pdf().set(opt).from(element).save().then(() => {
                // Show elements again
                toHide.forEach(el => el.classList.remove('hidden'));
            });
        }

        // Init
        window.onload = function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').value = today;
            generateSchedule();
            renderTiersInput();
        };

    </script>
</body>
</html>
